class Solution{
public:
    string decodeString(string s) {
        stack<int> numStack;
        stack<string> stringStack;
        int k = 0;

        for (char c : s) {
            if (isdigit(c)) {
                k = (k * 10) + (c - '0');
                continue;
            }

            if (c == '[') {
                numStack.push(k);
                k = 0;
                stringStack.push(string(1, c));
                continue;
            }

            if (c != ']') {
                stringStack.push(string(1, c));
                continue;
            }

            string temp;
            while (stringStack.top() != "[") {
                temp = stringStack.top() + temp;
                stringStack.pop();
            }

            // remove the "["
            stringStack.pop();

            // Get the new string
            string replacement;
            int count = numStack.top();
            for (int i = 0; i < count; i++)
                replacement += temp;

            // Add it to the stack
            stringStack.push(replacement);
            numStack.pop();
        }

        string result;
        while (!stringStack.empty()) {
            result = stringStack.top() + result;
            stringStack.pop();
        }
        return result;
    }
};

